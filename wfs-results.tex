% !TeX root = widefieldscan.tex
\svnidlong
{$HeadURL$}
{$LastChangedDate$}
{$LastChangedRevision$}
{$LastChangedBy$}

\section{Results}\label{sec:Results}
\subsection{Image Merging and Reconstruction}\label{sec:Image Merging and Reconstruction}
Figure~\ref{fig:wide-field-scan-results}(a) shows corrected projections from three overlapping subscans prior to merging, including regions where the subscans are overlapping. Figure~\ref{fig:wide-field-scan-results}(b) shows one merged projection prior to reconstruction and Figure~\ref{fig:wide-field-scan-results}(c) shows one slice of the reconstructed dataset. In Figure~\ref{fig:wide-field-scan-results} protocol B is show, because it was scanned using the highest number of projections. A reconstructed slice covers a field of view of 2792$\times$2792 pixels (4.13$\times$\SI{4.13}{\milli\meter}), which is almost three times the size of what can be achieved with one single binned scan (1024 pixels or \SI{1.52}{\milli\meter}). %1024 * 1.48 um/px = 1.51552mm
The dashed circles on the reconstructed slice mark the start and the end of the overlap region.

\begin{figure}
	\centering
	\caption{Workflow of a wide field scan. The images show a rat lung sample from a Sprague-Dawley rat, obtained 21 days after birth, scanned with the acquisition protocol B (Table~\ref{tab:protocols}). %
			(a) Three corrected and independently acquired projections from subscans $s_1$--$s_3$ are shown. Each one is 1024\(\times\)1024 pixels large and covers a field of view of \SI{1.52}{\milli\meter}. Subscans $s_1$ and $s_2$ overlap by 141 pixels (red and green overlay), subscans $s_2$ and $s_3$ overlap by 138 pixels (blue and yellow overlay). %
			(b) Merged projection obtained from the three subscans shown in subfigure (a). Each merged projection has a size of 2792\(\times\)1024 pixels. Due to the overlap required to merge the projections, the width of the merged projections is slightly smaller than three times the width of the subscans. %
			(c) Cropped slice of the reconstructed tomographic dataset. The dashed red circles mark the start and end of the overlap region.}
	\ifiucr
		\input{img/merge/iucr-Projections}\\%
		\input{img/merge/iucr-MergedProjections}\\%
		\input{img/merge/iucr-Slice}\\%
	\else
	\fi
	\label{fig:wide-field-scan-results}
\end{figure}

Figure~\ref{fig:s2-wfs} shows the advantages of the wide field acquisition scheme. With---in this particular case---an enlargement of the field of view by almost a factor of three, it is possible to visualize entire acini at high resolution. For a conventional scan (fig.~\ref{fig:s2-wfs}(a)), the airway segments in the sample are only partially contained inside the dataset (magenta and yellow). Semitransparent airway segments are contained in the sample, but are not visible in the field of view of a dataset obtained with a conventional scan. Increasing the field of view (fig.~\ref{fig:s2-wfs}(b)) allows the visualization of those segments to their full extent. A third acinus (cyan) which was not visible in Figure~\ref{fig:s2-wfs}(a) can now easily be visualized.

%\onecolumn
\renewcommand{\imsize}{.618\linewidth}%
\begin{figure}
	\centering
	\caption{Three-dimensional visualization of the distal-medial tip of the right lower rat lung lobe. The gray structure in the background shows a semitransparent view of the tomographic dataset with segmented airways. The foreground shows isosurfaces of terminal airways. The wireframe cube has a side length of 1024 pixels and encloses the field of view of one conventional scan. (a): Conventional scan; the extracted airway segments (magenta and yellow) are only partially contained inside the total sample volume. Airway segments not contained in the dataset, but present in the sample are shown semitransparent. This conventional scan corresponds to a reconstruction of the central of the three wide field scan subscans. (b): Wide field scan with increased field of view; the magenta and yellow segment show entire acini inside the dataset, the cyan segment contains a partially cut acinus. All airway segments inside the sample are contained in the tomographic dataset.}
	\ifiucr
	%%%%%%%%%%%%%%%%%%%
		\pgfmathsetlength{\imagewidth}{\imsize}%
		\pgfmathsetlength{\imagescale}{\imagewidth/1379}%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\def\x{852} % scalebar-x at golden ratio of x=1379px
			\def\y{898} % scalebar-y at 90% of height of y=998px
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0)
				{\includegraphics[width=\imagewidth]{img/conv_vs_wfs/scan-conventional}};
			% 618px = 1.5155mm > 100px = 245um > 204px = 500um, 41px = 100um
			%\draw[color=red,|-|,thick] (174,761) -- (753,977) node [sloped,midway,above] {\SI{1.5155}{\milli\meter} (1024px)};
			\draw[|-|,thick] (\x,\y) -- (\x+204,\y) node [fill=white, semitransparent, midway, above] {\SI{500}{\micro\meter}};
			\draw[|-|,thick] (\x,\y) -- (\x+204,\y) node [midway, above]{\SI{500}{\micro\meter}};
		\draw[anchor=south west] (0,998) node [fill=white, semitransparent] {(a)} node {(a)};
		\end{tikzpicture}%
	%%%%%%%%%%%%%%%%%%%
		\\%
		\pgfmathsetlength{\imagewidth}{\imsize}%
		\pgfmathsetlength{\imagescale}{\imagewidth/1379}%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\def\x{852} % scalebar-x at golden ratio of x=1379px
			\def\y{898} % scalebar-y at 90% of height of y=998px
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0)
				{\includegraphics[width=\imagewidth]{img/conv_vs_wfs/scan-widefield}};
			% 620px = 1.5155mm > 100px = 245um > 204px = 500um, 41px = 100um
			%\draw[color=red,|-|,thick] (174,761) -- (755,977) node [sloped,midway,above] {\SI{1.5155}{\milli\meter} (1024px)};
			\draw[|-|,thick] (\x,\y) -- (\x+204,\y) node [fill=white, semitransparent, midway, above] {\SI{500}{\micro\meter}};
			\draw[|-|,thick] (\x,\y) -- (\x+204,\y) node [midway, above]{\SI{500}{\micro\meter}};
			\draw[anchor=south west] (0,998) node [fill=white, semitransparent] {(b)} node {(b)};
		\end{tikzpicture}%
	%%%%%%%%%%%%%%%%%%%
	\else
	\fi
	\label{fig:s2-wfs}
\end{figure}
%\twocolumn

As expected, the calculated quality of the reconstructions representing the different protocols decreases as a function of total number of obtained projections (Figure~\ref{fig:NormalizedErrorPlot}). The calculated error of the different protocols (blue diamonds) shows the experimental results
\cbstart
obtained from actual scans of lung tissue. The plots for the simulation (19 protocols, as defined in section~\ref{sec:quality guided protocols}, red dots) and
\cbend
the normalized difference value are not perfectly in agreement, but show the same trend. The simulation shows an exponential decrease in quality, while the calculated, normalized error shows a more linear decrease in quality from protocol B towards protocol T.

\begin{figure}
	\centering
	\caption{Plot of normalized difference Value ($E_{i_{norm}}$, blue diamonds) for the 19 scanned protocols overlaid over Quality-plot (red dots) obtained from the simulation (described in section~\ref{sec:quality guided protocols}. The normalized Error has been calculated using the difference image of each protocol $i$ with protocol B. The error bars for each protocol show the standard deviation of the error calculated for 205 of the 1024 slices. Note that the scale of the error was normalized to 20--\SI{100}{\percent}, so that both the quality from the simulation and the error are directly comparable. The abscissa shows the scanning time in percentage of time used for the gold standard scan. Protocol T on the far left corresponds to the fastest scanning time, protocol B on the far right to the slowest. The protocols in between are shown from T--B for increasing percentage of the scanning time.}
	\ifiucr		
		\input{tikz-images/plots/2008c-MeanNormalizedErrorPlot}
	\else
	\fi
	\label{fig:NormalizedErrorPlot}
\end{figure}

\subsubsection{Three-dimensional visualization of different protocols}
\label{subsec:comparison}
The tomograms of the different protocols were three-dimensionally analyzed and visualized using MeVisLab (Version 2.0 (2009-06-09 Release), MeVis Medical Solutions AG and Fraunhofer MEVIS - Institute for Medical Image Computing, Bremen, Germany). Airway segments were extracted using a threshold interval based region growing algorithm~\cite{Zucker1976}. A seed point for the region growing algorithm was manually defined in the most proximal slice for each independent airway segment. The coordinates of the seed points were kept constant for protocol B--T, allowing direct comparison between the airway segment reconstructions of the different protocols. Airway segments extracted for protocol B, L and T are shown in Figure~\ref{fig:BvsT}.

The three-dimensional isosurface visualizations shown in Figure~\ref{fig:BvsT} represent three of the 19 scanned protocols. Protocol B corresponds to a slightly oversampled gold standard scan, obtained with total 15732 projections, recorded in \SI{66}{\minute}. Protocol L was obtained in \SI{35}{\minute} with total 7866 projections. Protocol T was obtained in \SI{12}{\minute} with 2185 projections for all three subscans. The tomographic dataset from protocol B was reconstructed from 5244 merged projections, the dataset from protocol L was reconstructed from 2622 merged projections and the dataset from protocol T was reconstructed using only 874 merged projections. Even though protocols L and T were scanned while violating the sampling theorem and with a total scanning time reduction of \SI{40}{\percent} (L) or more than \SI{86}{\percent} (T), the samples still appear to be identical to the gold standard protocol in the low-resolution three-dimensional visualizations shown in Figure~\ref{fig:BvsT}(a)--(c).

Figure~\ref{fig:BvsT}(d)--(f) show isosurface visualizations of the border between airspace and lung tissue as cubic regions of interest (256 pixels wide, marked blue in Figure~\ref{fig:BvsT}(a)--(c)). Because of experimental constraints, the cutline between the individual subscans could not be defined with a precision of one single pixel. As a consequence, the clipping plane does not lie in exactly the same position. This explains the appearing and disappearing holes in Figure~\ref{fig:BvsT}(d)--(f).

Even with the higher magnification, the reconstruction of protocol L in Figure~\ref{fig:BvsT}(e) appears nearly identical to the reconstruction of the region of interest of protocol B (fig.~\ref{fig:BvsT}(d)). The isosurface of the region of interest of protocol T shown in Figure~\ref{fig:BvsT}(f) appears rougher than the isosurface of protocol B. This roughness is introduced through ray-like artifacts visible in the original slice of the dataset of protocol T (not shown). These artifacts are the consequence of a strong subsampling. With the acquisition of only 874 projections instead of the required 5139, the sampling theorem is far from being satisfied. However, even with this strong undersampling, segmentation, three-dimensional reconstruction and visualization of the sample is still possible.

%\onecolumn
\renewcommand{\imsize}{.33\linewidth}%
\begin{figure}
	\centering
	\caption{Comparison of three-dimensional visualizations. %
			(a)--(c): Three independent airway segments (cyan, magenta, yellow) of tomographic datasets obtained with protocol B, L and T, extracted using a region growing algorithm. A cubic region of interest (blue) with a side length of 256 pixels (corresponding to \SI{379}{\micro\meter}) is marked inside the leftmost segment for all protocols. %
			(d)--(f): Detailed view of isosurfaces of the lung tissue inside the blue ROIs for protocol B, L and T, respectively. Note the increasing surface roughness in the alveolar surfaces for subfigures (e) and (f).}%
	\ifiucr			
		\pgfmathsetlength{\imagewidth}{\imsize}%
		\pgfmathsetlength{\imagescale}{\imagewidth/1770}%
		\def\x{1094} % scalebar-x at golden ratio of x=1770px
		\def\y{853} % scalebar-y at 90% of height of y=948px
	%%%%%%%%%%%%%%%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/comparisonBvsT/ob}};
			% 1415px = 1.9568mm > 100px = 138um > 361px = 500um, 72px = 100um
			% \draw[|-|,thick] (340,864) -- (1747,717) node [sloped,midway,above] {\SI{1.9568}{\milli\meter} (1322.171px)};
			\draw[|-|,thick] (\x,\y) -- (\x+361,\y) node [fill=white, semitransparent, midway, above] {\SI{500}{\micro\meter}};
			\draw[|-|,thick] (\x,\y) -- (\x+361,\y) node [midway, above]{\SI{500}{\micro\meter}};
			\draw[anchor=south west] (0,948) node [fill=white, semitransparent] {(a)} node {(a)};
		\end{tikzpicture}%
	%%%%%%%%%%%%%%%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/comparisonBvsT/ol}};
			% 1415px = 1.9568mm > 100px = 138um > 361px = 500um, 72px = 100um
			% \draw[|-|,thick] (340,864) -- (1747,717) node [sloped,midway,above] {\SI{1.9568}{\milli\meter} (1322.171px)};
			\draw[|-|,thick] (\x,\y) -- (\x+361,\y) node [fill=white, semitransparent, midway, above] {\SI{500}{\micro\meter}};
			\draw[|-|,thick] (\x,\y) -- (\x+361,\y) node [midway, above]{\SI{500}{\micro\meter}};
			\draw[anchor=south west] (0,948) node [fill=white, semitransparent] {(b)} node {(b)};
		\end{tikzpicture}%
	%%%%%%%%%%%%%%%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/comparisonBvsT/ot}};
			% 1415px = 1.9568mm > 100px = 138um > 361px = 500um, 72px = 100um
			% \draw[|-|,thick] (340,864) -- (1747,717) node [sloped,midway,above] {\SI{1.9568}{\milli\meter} (1322.171px)};
			\draw[|-|,thick] (\x,\y) -- (\x+361,\y) node [fill=white, semitransparent, midway, above] {\SI{500}{\micro\meter}};
			\draw[|-|,thick] (\x,\y) -- (\x+361,\y) node [midway, above]{\SI{500}{\micro\meter}};
			\draw[anchor=south west] (0,948) node [fill=white, semitransparent] {(c)} node {(c)};
		\end{tikzpicture}%
	%%%%%%%%%%%%%%%
		\\%
		\pgfmathsetlength{\imagewidth}{\imsize}%
		\pgfmathsetlength{\imagescale}{\imagewidth/799}%
		\def\x{494} % scalebar-x at golden ratio of x=799px
		\def\y{720} % scalebar-y at 90% of height of y=800px
	%%%%%%%%%%%%%%%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/comparisonBvsT/roiB}};
			% 758px = 0.37888mm > 100px = 50um > 1000px = 500um, 200px = 100um
			% \draw[|-|,thick] (20,138) -- (778,136) node [sloped,midway,above] {\SI{0.37888}{\milli\meter} (256px)};
			\draw[|-|,thick] (\x,\y) -- (\x+100,\y) node [fill=white, semitransparent, midway, above] {\SI{50}{\micro\meter}};
			\draw[|-|,thick] (\x,\y) -- (\x+100,\y) node [midway, above]{\SI{50}{\micro\meter}};
			\draw[anchor=south west] (0,800) node [fill=white, semitransparent] {(d)} node {(d)};
		\end{tikzpicture}%
	%%%%%%%%%%%%%%%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/comparisonBvsT/roiL}};
			% 758px = 0.37888mm > 100px = 50um > 1000px = 500um, 200px = 100um
			% \draw[|-|,thick] (20,138) -- (778,136) node [sloped,midway,above] {\SI{0.37888}{\milli\meter} (256px)};
			\draw[|-|,thick] (\x,\y) -- (\x+100,\y) node [fill=white, semitransparent, midway, above] {\SI{50}{\micro\meter}};
			\draw[|-|,thick] (\x,\y) -- (\x+100,\y) node [midway, above]{\SI{50}{\micro\meter}};
			\draw[anchor=south west] (0,800) node [fill=white, semitransparent] {(e)} node {(e)};
		\end{tikzpicture}%
	%%%%%%%%%%%%%%%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/comparisonBvsT/roiT}};
			% 758px = 0.37888mm > 100px = 50um > 1000px = 500um, 200px = 100um
			% \draw[|-|,thick] (20,138) -- (778,136) node [sloped,midway,above] {\SI{0.37888}{\milli\meter} (256px)};
			\draw[|-|,thick] (\x,\y) -- (\x+100,\y) node [fill=white, semitransparent, midway, above] {\SI{50}{\micro\meter}};
			\draw[|-|,thick] (\x,\y) -- (\x+100,\y) node [midway, above]{\SI{50}{\micro\meter}};
			\draw[anchor=south west] (0,800) node [fill=white, semitransparent] {(f)} node {(f)};
		\end{tikzpicture}%
	%%%%%%%%%%%%%%%
	\else
	\fi
	\label{fig:BvsT}
\end{figure}%
%\twocolumn%

For further analysis four regions of interest with a side length of 256 pixels (at \SI{1.48}{\micro\meter\per pixel}) have been extracted for each of the protocols B, L and T. The three-dimensional placement of these ROIs inside the sample is shown in Figure~\ref{fig:roi3d}.

\renewcommand{\imsize}{\columnwidth}
\begin{figure}
	\centering
	\caption{Overview of the placement of the four regions of interest where the histogram of the euclidean distance transformation distribution has been calculated. Grey: Semitransparent volume rendering of the lung tissue sample. Red: Four regions of interest, extracted to calculate the distance transformation. The labels of the ROIs conform to the legends in Figure~\ref{fig:DTFplots}.}%
	\ifiucr
		\pgfmathsetlength{\imagewidth}{\imsize}%
		\pgfmathsetlength{\imagescale}{\imagewidth/1563}%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\def\x{966} % scalebar-x at golden ratio of x=1563px
			\def\y{768} % scalebar-y at 90% of height of y=853px
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{img/dtf-roi/ROIs-3d}};
			% 1551px = 4.0138mm > 100px = 259um > 193px = 500um, 39px = 100um
			\draw[|-|,thick] (\x,\y) -- (\x+193,\y) node [fill=white, semitransparent, midway, above] {\SI{500}{\micro\meter}};
			\draw[|-|,thick] (\x,\y) -- (\x+193,\y) node [midway, above] {\SI{500}{\micro\meter}};
			\draw ( 300,400) node [fill=white, semitransparent] {ROI 1} node {ROI 1}; % 523-497-743
			\draw ( 740,460) node [fill=white, semitransparent] {ROI 2} node {ROI 2}; % 1382-546-743
			\draw ( 760,160) node [fill=white, semitransparent] {ROI 3} node {ROI 3}; % 1324-266-289
			\draw (1080,350) node [fill=white, semitransparent] {ROI 4} node {ROI 4}; % 1863-237-604
		\end{tikzpicture}%
	\else
	\fi		
	\label{fig:roi3d}
\end{figure}

Each of the ROIs has been binarized using an algorithmically determined threshold~\cite{Otsu1979} and small particles inside the segmented airspace lumen have been removed using connected components labelling. Subsequently, the euclidean distance transformation has been calculated for each thresholded ROI.

For comparison, the histogram of the euclidean distance transformation has been plotted for all four regions of interest in each protocol (B, L and T).

%\onecolumn
\renewcommand{\imsize}{.5\columnwidth}
\begin{figure}
	\centering
	\caption{Histogram-Plots for each of the of four ROIs, each showing the histogram of the distance transformation for the protocols B, L and T.}%
	\ifiucr%
		\input{tikz-images/plots/DTF-Plots/ROI-0523-0497-0743}%
		\input{tikz-images/plots/DTF-Plots/ROI-1382-0546-0743}\\%
		\input{tikz-images/plots/DTF-Plots/ROI-1324-0266-0289}%
		\input{tikz-images/plots/DTF-Plots/ROI-1863-0237-0604}%
	\else
	\fi	
	\label{fig:DTFplots}
\end{figure}
%\twocolumn

Figure~\ref{fig:DTFplots} shows logarithmic plots of the histogram distributions for the four selected ROIs; the blue, green and red plot show the histograms of the distance transformation of Protocol B, L and T, respectively. For all four regions of interest, the distribution of the euclidean distance transformation is very similar, only for larger airway diameters (between 50--\SI{60}{\micro\meter}) we see a detectable difference in the regions of interest 1 and 4, located in the lateral parts of the sample. If we remember that the histogram is plotted with a logarithmic y-axis, we see that the difference of the histograms is only visible for several hundred voxels.

Even when reducing the sample acquisition time by \SI{84}{\percent} of the gold standard scan (T vs. B), the distance transformation histograms of the shown regions of interest are very similar and therefore no relevant structural differences are introduced.

As a further proof of concept we scanned and reconstructed a rat lung sample with five scanning positions, resulting in a five-fold (4.74$\times$)
\cbstart
increase in field of view from slices with a size of 1024$\times$1024 pixels to a size of 4852$\times$4852 pixels (1.52$\times$\SI{1.52}{\milli\meter} to 7.18$\times$\SI{7.18}{\milli\meter})
\cbend
at a voxel side length of \SI{1.48}{\micro\meter} (data not shown).