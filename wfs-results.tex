% !TeX root = widefieldscan.tex
\svnidlong
{$HeadURL$}
{$LastChangedDate$}
{$LastChangedRevision$}
{$LastChangedBy$}

\section{Results}\label{sec:Results}
\subsection{Image Merging and Reconstruction}\label{sec:Image Merging and Reconstruction}
Figure~\ref{fig:wide-field-scan-results}(a) shows corrected projection images from three overlapping subscans prior to merging, including regions where the subscans are overlapping. Figure~\ref{fig:wide-field-scan-results}(b) shows one merged projection image prior to reconstruction and Figure~\ref{fig:wide-field-scan-results}(c) shows one slice of the reconstructed dataset. For Figure~\ref{fig:wide-field-scan-results} we have chosen to show protocol B in particular because it shows the best case for image quality. Such a reconstructed slice covers a field of view of 2792$\times$2792 pixels (4.13$\times$\SI{4.13}{\milli\meter}), which is almost three times the size of what can be achieved with one single binned scan (1024 pixels or \SI{1.52}{\milli\meter}). %1024 * 1.48 um/px = 1.51552mm
The dashed circles on the reconstructed slice mark the start and the end of the overlap region.

\begin{figure}
	\centering
	\caption{Workflow of a wide field scan. The images show a rat lung sample from a Sprague-Dawley rat, obtained 21 days after birth, scanned with the acquisition protocol B, as described in Table~\ref{tab:protocols}. %
			(a) Three corrected and independently acquired projection images from subscans $s_1$--$s_3$, each with a size of 1024\(\times\)1024 pixels, thus each covering a field of view of \SI{1.52}{\milli\meter}. Subscans $s_1$ and $s_2$ overlap each other by 141 pixels (red and green overlay), subscans $s_2$ and $s_3$ overlap each other by 138 pixels (blue and yellow overlay). %
			(b) Merged projection obtained from the three subscans shown in subfigure (a). Each merged projection has a size of 2793\(\times\)1024 pixels. Due to the overlap required to merge the projections, the width of the merged projections is slightly smaller than three times the width of the subscans. %
			(c) Cropped slice of the reconstructed tomographic dataset. The dashed red circles mark the start and end of the overlap region.}
	\ifiucr
		\input{img/merge/iucr-Projections}\\%
		\input{img/merge/iucr-MergedProjections}\\%
		\input{img/merge/iucr-Slice}\\%
	\else
	\fi
	\label{fig:wide-field-scan-results}
\end{figure}

Figure~\ref{fig:s2-wfs} clearly shows the advantages provided by the wide field acquisition scheme. With---in this particular case---an enlargement of the field of view by almost a factor of 3, it is possible to visualize several full acini at high resolution. For a conventional scan (fig.~\ref{fig:s2-wfs}(a)), the airway segments in the sample are only partially contained inside the dataset (green and red segment\todo{color?}). Increasing the field of view (fig.~\ref{fig:s2-wfs}(b)) allows the visualization of those segments to their full extent. A third acinus (yellow\todo{color?}) which was not visible in Figure~\ref{fig:s2-wfs}(a) can now easily be visualized.

%\onecolumn
\begin{figure}
	\centering
	\caption{Three-dimensional visualization of the distal-medial tip of the right lower lung lobe of a Sprague Dawley rat. The gray structure in the background shows a semitransparent view of the sample with segmented airways. The foreground shows isosurfaces of terminal airways. (a): Conventional scan; the extracted airway segments (green and red) are only partially contained inside the total sample volume. This conventional scan corresponds to a reconstruction of the central of the three wide field scan subscans. (b): Wide field scan with increased field of view; the green and red segment show multiple full acini inside the dataset, the yellow segment contains a partially cut acinus.}
\todo[inline]{colors?}
	\ifiucr
		\renewcommand{\imsize}{\linewidth}%
		\pgfmathsetlength{\imagewidth}{\imsize}%
		\pgfmathsetlength{\imagescale}{\imagewidth/1202}%
		\def\x{250}% scalebar-x at golden ratio of x=1202px (=743)
		\def\y{575}% scalebar-y at 90% of height of y=680px (=612)
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0)
				{\includegraphics[width=\imagewidth]{img/widefieldscanning/R108C04C-overview-s2}};
			% 423px = 1.5155mm > 100px = 358um > 140px = 500um
			% \draw[|-|,thick] (238,388) -- (638,527) node [white,sloped,midway,above] {\SI{1.5155}{\milli\meter} (1024px)};
			\draw[|-|,thick] (\x,\y) -- (\x+140,\y) node [midway, above] {\SI{500}{\micro\meter}};
			\node [anchor=south west] at (0,680) {(a)};
		\end{tikzpicture}%
		\\%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0)
				{\includegraphics[width=\imagewidth]{img/widefieldscanning/R108C04C-overview-merge}};
			% 423px = 1.5155mm > 100px = 358um > 140px = 500um
			%\draw[|-|,thick] (238,388) -- (638,527) node [white,sloped,midway,above] {\SI{1.5155}{\milli\meter} (1024px)};
			\draw[|-|,thick] (\x,\y) -- (\x+280,\y) node [midway, above] {\SI{1}{\milli\meter}};
			\node [anchor=south west] at (0,680) {(b)};
		\end{tikzpicture}%
	\else
	\fi
	\label{fig:s2-wfs}
\end{figure}
%\twocolumn


As can be seen in Figure~\ref{fig:NormalizedErrorPlot}, the calculated quality of the reconstructions from the different protocols decreases as amount of total obtained projections decreases, as expected. The calculated error of the different protocols, compared to a gold standard protocol (blue diamonds) shows experimental results not derived using simulations with a phantom, but rather real data obtained from actual scans of lung tissue. The plots for the simulation and the normalized difference value are not perfectly in agreement, but show the same trend. The simulation shows an exponential decrease in quality, while the calculated, normalized error shows a more linear decrease in quality from protocol B towards protocol T.

\begin{figure}
	\centering
	\caption{Plot of normalized difference Value ($E_{i_{norm}}$, blue diamonds) for the 19 scanned protocols overlaid over Quality-plot (red dots) obtained from the simulation. The normalized Error has been calculated using the difference image of each protocol $i$ with protocol B. The error bars for each protocol show the standard deviation of the error calculated for 205 of the 1024 slices. Note that the scale of the error was normalized to 20--\SI{100}{\percent}, so that both the quality from the simulation and the error are directly comparable. The abscissa shows the scanning time in percentage of time used for the gold standard scan. Protocol T corresponds to the fastest scanning time, protocol B to the slowest. The protocols in between are shown in decreasing order from T--B for increasing percentage of the scanning time.}
	\ifiucr		
		\input{tikz-images/plots/2008c-MeanNormalizedErrorPlot}
	\else
	\fi
	\label{fig:NormalizedErrorPlot}
\end{figure}

\subsubsection{Three-dimensional visualization of different protocols}
\label{subsec:comparison}
The tomograms of the different protocols were three-dimensionally analyzed and visualized using MeVisLab (Version 2.0 (2009-06-09 Release), MeVis Medical Solutions AG and Fraunhofer MEVIS - Institute for Medical Image Computing, Bremen, Germany). Airway segments were extracted using a threshold interval based region growing algorithm~\cite{Zucker1976}. A seed point for the region growing algorithm was manually defined in the most proximal slice for each independent airway segment. The coordinates of the seed points were kept constant for protocol B--T, allowing direct comparison between the airway segment reconstructions of the different protocols. Airway segments extracted for protocol B, L and T are shown in Figure~\ref{fig:BvsT}.

The three-dimensional isosurface visualizations shown in Figure~\ref{fig:BvsT} represent three of the 19 scanned protocols. Protocol B corresponds to a slightly oversampled gold standard scan, obtained with total 15732 projections, recorded in \SI{66}{\minute}. Protocol L was obtained in \SI{35}{\minute} with total 7866 projections. Protocol T was obtained in \SI{12}{\minute} with 2185 projections for all three subscans. The tomographic dataset from protocol B was reconstructed from 5244 merged projection images, the dataset from protocol L was reconstructed from 2622 merged projections and the dataset from protocol T was reconstructed using only 874 merged projections. Even though protocols L and T were scanned while violating the sampling theorem and with a total scanning time reduction of \SI{40}{\percent} (L) or more than \SI{86}{\percent} (T), the samples still appear to be identical to the gold standard protocol in the low-resolution three-dimensional visualizations shown in Figure~\ref{fig:BvsT}(a)--(c).

Figure~\ref{fig:BvsT}(d)--(f) show an isosurface visualization of the border between airspace and lung tissue as a cubic regions of interest (256 pixels wide) marked in blue in Figure~\ref{fig:BvsT}(a)--(c). Because of experimental constraints, the cutline between the individual subscans could not be defined with a precision of one single pixel. As a consequence, the clipping plane does not lie in exactly the same position. This explains the appearing and disappearing hole in Figure~\ref{fig:BvsT}(d)--(f).

Even with the higher magnification, the reconstruction of protocol L in Figure~\ref{fig:BvsT}(e) appears nearly identical to the reconstruction of the region of interest of protocol B (fig.~\ref{fig:BvsT}(d)). The isosurface of the region of interest of protocol T shown in Figure~\ref{fig:BvsT}(f) appears rougher than the isosurface of protocol B. This roughness is introduced through ray-like artifacts visible in the original slice of the dataset of protocol T (not shown). These artifacts are the consequence of a strong subsampling. With the acquisition of only 874 projections instead of the required 5139, the sampling theorem is far from being satisfied. However, even with this strong undersampling, segmentation, three-dimensional reconstruction and visualization of the sample is still possible.

%\onecolumn
\begin{figure}
	\centering
	\caption{Comparison of three-dimensional visualizations. %
			(a)--(c): Three independent airway segments (green, red, yellow) of tomographic datasets obtained with protocol B, L and T, extracted using a region growing algorithm. A cubical region of interest (ROI, blue) with a side length of 256 pixels (corresponding to \SI{379}{\micro\meter}) is marked inside the leftmost segment for all protocols. %
			(d)--(f): Detailed view of isosurfaces of the lung tissue inside the ROIs for protocol B, L and T, respectively. Note the artifacts in the alveolar surfaces in subfigures (e) and (f).}%
	\todo[inline]{colors?}
	\ifiucr			
		\renewcommand{\imsize}{.33\linewidth}%
		\pgfmathsetlength{\imagewidth}{\imsize}%
		\pgfmathsetlength{\imagescale}{\imagewidth/1085}%
		\def\x{551} % scalebar-x at golden ratio of x=1085px (671px = golden ratio: 551 is set to fit the one-column-width in draft mode!!!)
		\def\y{530} % scalebar-y at 90% of height of y=589px
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0)
				{\includegraphics[width=\imagewidth]{img/comparisonBvsT/ob}};
			% 1030px = 2.627mm > 100px = 255um > 196px = 500um
			%\draw[|-|,thick] (30,339) -- (1054,454) node [white,sloped,midway,above] {\SI{2.627}{\milli\meter} (1775px)};
			\draw [|-|,thick] (\x,\y) -- (\x+196,\y) node [fill=white,semitransparent,right] {\SI{500}{\micro\meter}} node [right] {\SI{500}{\micro\meter}};
			\node [fill=white,semitransparent,anchor=south west] at (0,589) {(a)};
			\node [anchor=south west] at (0,589) {(a)};
		\end{tikzpicture}%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]%
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0)
				{\includegraphics[width=\imagewidth]{img/comparisonBvsT/ol}};
			% 1030px = 2.627mm > 100px = 255um > 196px = 500um
			\draw [|-|,thick] (\x,\y) -- (\x+196,\y) node [fill=white,semitransparent,right] {\SI{500}{\micro\meter}} node [right] {\SI{500}{\micro\meter}};
			\node [fill=white,semitransparent,anchor=south west] at (0,589) {(b)};
			\node [anchor=south west] at (0,589) {(b)};
		\end{tikzpicture}%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]%
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0)
				{\includegraphics[width=\imagewidth]{img/comparisonBvsT/ot}};
			% 1030px = 2.627mm > 100px = 255um > 196px = 500um
			\draw [|-|,thick] (\x,\y) -- (\x+196,\y) node [fill=white,semitransparent,right] {\SI{500}{\micro\meter}} node [right] {\SI{500}{\micro\meter}};
			\node [fill=white,semitransparent,anchor=south west] at (0,589) {(c)};
			\node [anchor=south west] at (0,589) {(c)};
		\end{tikzpicture}%
		\\%
		\pgfmathsetlength{\imagewidth}{\imsize}%
		\pgfmathsetlength{\imagescale}{\imagewidth/816}%
		\def\x{504} % scalebar-x at golden ratio of x=816px
		\def\y{734} % scalebar-y at 90% of height of y=815px
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]%
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0)
				{\includegraphics[width=\imagewidth]{img/comparisonBvsT/roiB}};
			% 761px = 0.37888mm > 100px = 50um > 100.4px = 500um
%			\draw[|-|,thick] (792,438) -- (31,435) node [sloped,midway,above] {\SI{378.88}{\micro\meter} (256px)};
			\draw[|-|,thick] (\x,\y) -- (\x+100.4,\y) node [fill=white,semitransparent,right] {\SI{50}{\micro\meter}} node [right] {\SI{50}{\micro\meter}};
			\node [fill=white,semitransparent,anchor=south west] at (0,815) {(d)};
			\node [anchor=south west] at (0,815) {(d)};
	\end{tikzpicture}%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]%
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0)
				{\includegraphics[width=\imagewidth]{img/comparisonBvsT/roiL}};
			% 761px = 0.37888mm > 100px = 50um > 100.4px = 500um
			\draw[|-|,thick] (\x,\y) -- (\x+100.4,\y) node [fill=white,semitransparent,right] {\SI{50}{\micro\meter}} node [right] {\SI{50}{\micro\meter}};
			\node [fill=white,semitransparent,anchor=south west] at (0,815) {(e)};
			\node [anchor=south west] at (0,815) {(e)};
		\end{tikzpicture}%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]%
			\node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0)
				{\includegraphics[width=\imagewidth]{img/comparisonBvsT/roiT}};
			% 761px = 0.37888mm > 100px = 50um > 100.4px = 500um
			\draw[|-|,thick] (\x,\y) -- (\x+100.4,\y) node [fill=white,semitransparent,right] {\SI{50}{\micro\meter}} node [right] {\SI{50}{\micro\meter}};
			\node [fill=white,semitransparent,anchor=south west] at (0,815) {(f)};
			\node [anchor=south west] at (0,815) {(f)};
		\end{tikzpicture}%
	\else
	\fi
	\label{fig:BvsT}
\end{figure}
%\twocolumn%

For further analysis four regions of interest with a side length of 256 pixels (at \SI{1.48}{\micro\meter\per pixel}, thus containing a volume of %
\ifhtml%
	1.678*$10^7$ voxels%
\else
	\SI{1.678e7}{voxels}%
\fi ) have been extracted for each of the protocols B, L and T. The three-dimensional placement of these ROIs inside the sample is shown in Figure~\ref{fig:roi3d}. Each of the ROIs has been binarized using an algorithmically determined threshold~\cite{Otsu1979} and small particles inside the segmented airspace lumen have been removed using a connected components analysis. Subsequently, the euclidean distance transformation has been calculated for each thresholded ROI.

\renewcommand{\imsize}{\columnwidth}
\begin{figure}
	\centering
	\caption{Overview of the placement of the four regions of interest where the histogram of the euclidean distance transformation distribution has been calculated. Grey: Semitransparent volume rendering of the lung tissue sample. Red: Four regions of interest, extracted to calculate the distance transformation. The labels of the ROIs conform to the legends in Figure~\ref{fig:DTFplots}.}%
	\ifiucr
		\pgfmathsetlength{\imagewidth}{\imsize}%
		\pgfmathsetlength{\imagescale}{\imagewidth/1563}%
		\begin{tikzpicture}[x=\imagescale,y=-\imagescale]
			\def\x{966-750} % scalebar-x at golden ratio of x=1563px
			\def\y{768} % scalebar-y at 90% of height of y=853px
			\node[anchor=north west,inner sep=0pt,outer sep=0pt] at (0,0)
				{\includegraphics[width=\imagewidth]{img/dtf-roi/ROIs-3d}};
			% 1551px = 4.0138mm > 100px = 259um > 193px = 500um, 39px = 100um
			\draw[|-|,thick] (\x,\y) -- (\x+193,\y) node [midway,above] {\SI{500}{\micro\meter}};
			\draw ( 300,400) node [fill=white, semitransparent] {523-497-743} node {523-497-743};
			\draw ( 740,460) node [fill=white, semitransparent] {1382-546-743} node {1382-546-743};
			\draw ( 760,160) node [fill=white, semitransparent] {1324-266-289} node {1324-266-289};
			\draw (1080,350) node [fill=white, semitransparent] {1863-237-604} node {1863-237-604};
		\end{tikzpicture}%
	\else
	\fi		
	\label{fig:roi3d}
\end{figure}

For comparison, the histogram of the euclidean distance transformation has been plotted for all four regions of interest in each protocol (B, L and T).

\renewcommand{\imsize}{.5\columnwidth}
%\onecolumn
\begin{figure}
	\centering
	\caption{Histogram-Plots for each of the of 4 ROIs, each showing the histogram of the distance transformation for the protocols B, L and T.}%
	\ifiucr%
		\input{tikz-images/plots/DTF-Plots/ROI-0523-0497-0743}%
		\input{tikz-images/plots/DTF-Plots/ROI-1382-0546-0743}\\%
		\input{tikz-images/plots/DTF-Plots/ROI-1324-0266-0289}%
		\input{tikz-images/plots/DTF-Plots/ROI-1863-0237-0604}%
	\else
	\fi	
	\label{fig:DTFplots}
\end{figure}
%\twocolumn

Figure~\ref{fig:DTFplots} shows logarithmic plots of the histogram distributions for the four selected ROIs; the blue, green and red plot show the histograms of the distance transformation of Protocol B, L and T, respectively. For all four regions of interest, the distribution of the euclidean distance transformation is very similar, only for larger airway diameters (approx. 50--\SI{60}{\micro\meter}) we see a discernible difference in the regions of interest 3 and 4. If we remember that the histogram is plotted with a logarithmic y-axis, we see that the difference of the histograms is only visible for several hundred voxels.

Thus, reducing the sample acquisition time by \SI{84}{\percent} of the gold-standard scan (T vs. B), the distance transformation histograms are both very similar and therefore no relevant structural differences are introduced.

Additionally, we have been able to increase the field of view even further; we also scanned and reconstructed a rat lung sample with 5 scanning positions, resulting in a five-fold (4.74$\times$) increase in available field of view from 1024$\times$1024 pixels to 4852$\times$4852 pixels (reconstructions not shown). We have been able to reconstruct a sample with a size of 0.82$\times$7.18$\times$\SI{1.52}{\milli\meter} %(cropped from 4852$\times$4852$\times$1024 down to 552$\times$4852$\times$1024 pixels) 
at a voxel side length of \SI{1.48}{\micro\meter}.