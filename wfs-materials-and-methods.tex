\svnidlong
{$HeadURL$}
{$LastChangedDate$}
{$LastChangedRevision$}
{$LastChangedBy$}
\framebox{Author: \svnauthor|Rev: \svnrev|Last change: \svndate}% - URL: \url{\svnkw{HeadURL}}}
\section{Materials and Methods}
\label{sec:materials and methods}
\subsection{Animal Handling and Tissue Preparation}
The preparation of the lung samples has been performed according to~\citet{Schittny1997,Schittny1998}. Briefly, the lungs have been extracted from Sprague-Dawley rats after they have been perfused and filled with phosphate buffered saline by instillation via tracheostomy until the midrespiratory lung volume was reached.

The extracted lung lobes have been fixed in 2.5\% glutaraldehyde (C$_5$H$_8$O$_2$) for potential storage. For the preparation of the imaging the samples have been postfixed --- as in electron microscopy --- with 1\% osmium tetroxide (OsO$_4$) and stained with 4\% uranyl acetate (C$_4$H$_6$O$_6$U), dehydrated in a graded series ethanol and transferred into paraffin.\todo{Citation or longer explanation} Osmium tetroxide and uranyl acetate exhibit a higher absorption contrast for x-rays than the unstained lung tissue, thus facilitating the imaging of the stained tissue.

Handling of the animals before and during the experiments, as well as the experiments themselves, were approved and supervised by the Swiss Agency for the Environment, Forests and Landscape and the Veterinary Service of the Canton of Bern.

\subsection{SRXTM}
The experiments were performed on the TOMCAT beamline at the Swiss Light Source, Paul Scherrer Institut, Villigen, Switzerland. TOMCAT is one of thirteen operating beam lines at the SLS\todo{13, still true?}. It is located at the port X02DA of the SLS. The beamline receives photons from a \unit{2.9}{\tesla} super-bending magnet. The critical energy of this super-bending magnet is \unit{11.1}{\kilo\electronvolt} (corresponding to a wavelength of \unit{0.122}{\nano\meter}). Detailed technical specifications of the beamline and beam characteristics have been described by~\citet{Stampanoni2006a,Stampanoni2007}.

\subsubsection{Image Acquisition}
\begin{itemize}
	\item Mounting of the samples
\end{itemize}
The samples were scanned at an x-ray energy of \unit{12.6}{\kilo\electronvolt}. After penetration of the sample, the x-rays are converted into visible light by a Ce-doped YAG scintillator (Crismatec Saint-Gobain, Nemours, France\todo{still true?}). These projection images were further magnifed by diffraction limited microscope optics and digitized by a high-resolution \numprint{2048}$\times$\numprint{2048} pixel CCD camera. All samples were imaged using 10$\times$ magnification, and with 2$\times$2 binning and \unit{125}{\milli\second} exposure time or no binning and \unit{500}{\milli\second} exposure time, resulting in isotropic voxely of a side length of \unit{1.4}{\micro\meter} or of \unit{0.70}{\micro\meter}\todo{correct sidelength?}, respectively.

As mentioned in section~\ref{subsec:enhancing the field of view}, to obtain an enhanced FOV, we need to scan the samples with multiple subscans at varying positions covering the whole sample. To achieve this, we have written a custom MATLAB\textregistered-script\todo{Script(s) in Appendix?} (MATLAB 7.6.0.321 (R2008a), The MathWorks, Inc.), where the user is able to input the scanning parameters like desired FOV, detector width, desired overlap between the subscans, magnification and binning. According to these parameters, MATLAB has written a preference file to the disk, which has been parsed by a custom Python-script that was used for the interaction with the EPIC-System (Experimental Physics and Industrial Control System, \url{http://www.aps.anl.gov/epics/}), which is controlling the TOMCAT beamline. The sample on the sample holder was not touched while the the different subscans have been performed. All parameters like filename, sample-position in relation to the beam, rotation angles and amount of projections to obtain for the subscans have been set beforehand by the MATLAB-script, read out by the Python-script so that all the scans have been performed as a batch job without manual intervention.

\subsection{Image Processing}
\label{subsec:image processing}
\begin{itemize}
	\item dark- and flatfield-correction
	\item interpolation
	\item correct stitching with MATLAB
	\item reconstruction on cluster
\end{itemize}
To achieve a tomographic image for each sample, a varying amount of projections were obtained over a sample rotation of \unit{180}{\degree}. To cover the desired FOV, the projection images have to be obtained in such a manner that they overlap each other slightly. This overlap is necessary for the compensation of variations in the imaging process and correct stitching of the single projections into one big projection image. 

After the acquisition of the sub-scan projection images, these image sets are corrected with the so called dark field and flat field images, as seen in figure~\ref{subfig:flat}. The dark field images are obtained with no x-ray beam for the detection of intrinsic noise in the apparatus, the flat field images are obtained with x-ray beam, but without the sample. They are recorded to remove the varying beam profile brightness from the projection images.

After normalization, the projections of the single subscans are merged into one projection which overlaps the full FOV chosen by the end-user (see figure~\ref{subfig:mrg}). To achieve a correct stitching of the sub-scan projections, the correct cutting line to remove the overlap is calculated using the mutual difference between adjacent subscans. Since the amount of obtained projection varies for different positions of the sample in relation to the camera window --- at outer positions we record more projections compared to central positions --- we also have to interpolate projection images prior to stitching. All this has been achieved using a custom MATLAB\textsuperscript{\textregistered} script which incorporates the loading, normalizing, interpolation and correct stitching of the images into wide field projections as seem in the aforementioned figure.

After the merging of the normalized projections, the merged projections were reconstructed into the virtual tomography slices using a standard filtered backprojection algorithm or a FFT-based gridrec algorithm~\cite{Dowd2003} on a 20-node server farm (Pentium 4, 2.8 GHz processor, 512 MB RAM\todo{cluster node specs?}). This reconstruction results in an image stack of \numprint{1024} or \numprint {2048} image slices in tif-format, depending on the binnig chosen at recording time. The size of the images recorded for this publication varies from \numprint{2996}$\times$\numprint{2996} pixels up to \numprint{9703}$\times$\numprint{9703} pixels\todo{9703 px not really reconstructed up to now\ldots}.